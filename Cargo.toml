[package]
name = "fold"
version = "0.1.0"
edition = "2024"

[features]
default = []
distributed = [
    "dep:amiquip",
    "dep:postgres",
    "dep:aws-sdk-s3",
    "dep:aws-config",
    "dep:tokio",
    "dep:dotenv",
    "dep:bb8",
    "dep:lru",
    "dep:once_cell",
    "dep:crossbeam-channel",
    "dep:reqwest",
    "dep:tracing",
    "dep:tracing-subscriber",
    "dep:tracing-opentelemetry",
    "dep:opentelemetry",
    "dep:opentelemetry_sdk",
    "dep:opentelemetry-otlp",
]

[dependencies]
# Core dependencies (always included)
bincode = "2.0.1"
fixedbitset = "0.5.7"
itertools = "0.12"
serde = { version = "1.0.219", features = ["derive"] }
serde_json = "1.0.141"
clap = { version = "4", features = ["derive"] }
rustc-hash = "1.1"
smallvec = "1.13"
base64 = "0.22.1"

# Distributed dependencies (optional)
amiquip = { version = "0.4.2", optional = true }
postgres = { version = "0.19", optional = true }
aws-sdk-s3 = { version = "1.100.0", optional = true }
aws-config = { version = "1.8.3", optional = true }
tokio = { version = "1", features = ["rt-multi-thread", "macros"], optional = true }
dotenv = { version = "0.15", optional = true }
bb8 = { version = "0.9.0", optional = true }
lru = { version = "0.12", optional = true }
once_cell = { version = "1.19", optional = true }
crossbeam-channel = { version = "0.5.15", optional = true }
reqwest = { version = "0.12.22", features = ["blocking"], optional = true }
tracing = { version = "0.1", features = ["attributes"], optional = true }
tracing-subscriber = { version = "0.3", features = ["env-filter"], optional = true }
tracing-opentelemetry = { version = "0.30", optional = true }
opentelemetry = { version = "0.29", optional = true }
opentelemetry_sdk = { version = "0.29", optional = true }
opentelemetry-otlp = { version = "0.29", features = ["reqwest-blocking-client"], optional = true }

[dev-dependencies]
criterion = { version = "0.5", features = ["html_reports"] }

[[bin]]
name = "fold_single"
path = "src/bin/fold_single.rs"
required-features = []

[[bin]]
name = "fold_worker"
path = "src/bin/fold_worker.rs"
required-features = ["distributed"]

[[bin]]
name = "follower"
path = "src/bin/follower.rs"
required-features = ["distributed"]

[[bin]]
name = "feeder"
path = "src/bin/feeder.rs"
required-features = ["distributed"]

[[bin]]
name = "ingestor"
path = "src/bin/ingestor.rs"
required-features = ["distributed"]

[[bench]]
name = "spatial_bench"
harness = false
path = "benches/spatial_bench.rs"

[[bench]]
name = "ortho_bench"
harness = false
path = "benches/ortho_bench.rs"
